# Omusubi フレームワーク 単体テスト

このディレクトリには、Omusubiフレームワークのコアコンポーネント向けの単体テストが含まれています。

## テスト対象コンポーネント

### 1. `span<T>` (test_span.cpp)
- 非所有メモリビュー（C++20 std::spanの簡易版）
- 基本機能、イテレータ、部分span操作、型変換のテスト

### 2. `StringView` (test_string_view.cpp)
- UTF-8対応の文字列ビュー
- 基本機能、UTF-8処理、部分文字列、比較、検索、イテレータのテスト
- UTF-8ヘルパー関数のテスト

### 3. `FixedString<N>` (test_fixed_string.cpp)
- 固定長UTF-8文字列（ヒープ確保なし）
- 基本機能、追加操作、容量制限、UTF-8処理、クリア、比較、変換のテスト

### 4. `FixedBuffer<N>` (test_fixed_buffer.cpp)
- 固定長バイトバッファ（ヒープ確保なし）
- 基本機能、追加操作、容量制限、アクセス、イテレータ、span変換のテスト

### 5. `Vector3` (test_vector3.cpp)
- 3次元ベクトル（センサーデータ用）
- 基本機能、constexpr対応、代入操作、センサーデータのユースケースのテスト

## ビルドと実行

### ビルド
```bash
cd test
make
```

### テスト実行
```bash
make run
```

または

```bash
./test_runner
```

### クリーン
```bash
make clean
```

## テストフレームワーク

軽量なカスタムテストフレームワーク (`test_framework.hpp`) を使用しています。

**特徴:**
- 外部依存なし（組み込み環境に最適）
- シンプルなアサーションマクロ
- テスト結果の自動カウント
- 日本語対応

**利用可能なマクロ:**
- `TEST_ASSERT(condition, message)` - 条件のアサーション
- `TEST_ASSERT_EQ(actual, expected, message)` - 等価性のアサーション
- `TEST_ASSERT_STR_EQ(actual, expected, message)` - 文字列の等価性
- `TEST_ASSERT_FLOAT_EQ(actual, expected, epsilon, message)` - 浮動小数点の等価性

## 要件

- C++14コンパイラ（clang++推奨）
- Make

## テスト結果の例

```
╔═══════════════════════════════════════╗
║  Omusubi フレームワーク 単体テスト    ║
╚═══════════════════════════════════════╝

========================================
テストスイート: span<T>
========================================

[基本機能]
  ✓ 空のspanはempty()がtrue
  ✓ 空のspanのサイズは0
  ...

========================================
結果: 24 / 24 テスト成功
========================================

...

╔═══════════════════════════════════════╗
║  ✓ すべてのテストが成功しました       ║
╚═══════════════════════════════════════╝
```

## テストの追加

新しいテストを追加する場合：

1. `test_*.cpp` という名前でテストファイルを作成
2. 適切なネームスペースで囲む（例: `namespace new_test { ... }`）
3. `Makefile`の`TEST_SOURCES`に追加
4. `test_all.cpp`にテストのエントリーポイントを追加

## 注意事項

- すべてのテストはプラットフォーム非依存です
- ヘッダーオンリーのコンポーネントのみをテスト対象としています
- 組み込みハードウェアに依存するコンポーネント（M5Stack固有など）はテストに含まれていません
